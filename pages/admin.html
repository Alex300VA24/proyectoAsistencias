<!doctype html>
<html lang="es">
  <head>
    <script>
      if (!localStorage.getItem('adminToken')) {
        window.location.href = 'index.html';
      }
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel Administrador - Instituto Leonardo Da Vinci</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Estilos -->
    <link rel="stylesheet" href="../style/style.css" />
  </head>
  <body class="admin-body">
    <div class="admin-container">
      <!-- HEADER ADMIN -->
      <header class="admin-header">
        <button onclick="cerrarSesion()" class="btn-sm" style="position:absolute; top:20px; right:20px; background: rgba(255,255,255,0.2); color:white; border:none;">
            <i class="fas fa-sign-out-alt"></i> Salir
        </button>
        <div class="admin-header-icon">
          <i class="fas fa-user-shield"></i>
        </div>
        <h1>Panel de Administraci√≥n</h1>
        <p class="admin-subtitle">
          <i class="fas fa-school"></i>
          Instituto Leonardo Da Vinci
        </p>
      </header>

      <!-- CONTENIDO -->
      <div class="admin-content">
        <!-- PESTA√ëAS -->
        <div class="admin-tabs">
          <button class="admin-tab-btn active" onclick="cambiarTab('docentes')">
            <i class="fas fa-users"></i> Docentes
          </button>
          <button class="admin-tab-btn" onclick="cambiarTab('cursos')">
            <i class="fas fa-book"></i> Cursos
          </button>
          <button class="admin-tab-btn" onclick="cambiarTab('reportes')">
            <i class="fas fa-chart-bar"></i> Reportes
          </button>
        </div>

        <!-- TAB: DOCENTES -->
        <div id="docentes-tab" class="admin-tab-content active">
          <div class="admin-section-header">
            <i class="fas fa-users"></i>
            <h2>Gesti√≥n de Docentes</h2>
          </div>

          <button class="btn-primary btn-add" onclick="abrirModalDocente()">
            <i class="fas fa-plus"></i> Agregar Docente
          </button>

          <div class="table-container">
            <table id="tablaDocentes">
              <thead>
                <tr>
                  <th>DNI</th>
                  <th>Nombre</th>
                  <th>Cursos Asignados</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="listaDocentes"></tbody>
            </table>
          </div>
        </div>

        <!-- TAB: CURSOS -->
        <div id="cursos-tab" class="admin-tab-content">
          <div class="admin-section-header">
            <i class="fas fa-book"></i>
            <h2>Gesti√≥n de Cursos</h2>
          </div>

          <button class="btn-primary btn-add" onclick="abrirModalCurso()">
            <i class="fas fa-plus"></i> Agregar Curso
          </button>

          <div class="table-container">
            <table id="tablaCursos">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>D√≠a</th>
                  <th>Hora Inicio</th>
                  <th>Hora Fin</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="listaCursos"></tbody>
            </table>
          </div>
        </div>

        <!-- TAB: REPORTES -->
        <div id="reportes-tab" class="admin-tab-content">
          <div class="admin-section-header">
            <i class="fas fa-chart-bar"></i>
            <h2>Descargar Reportes</h2>
          </div>

          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Docente</th>
                  <th>DNI</th>
                  <th>Curso</th>
                  <th>Acci√≥n</th>
                </tr>
              </thead>
              <tbody id="listaReportes"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- FOOTER -->
      <footer class="footer admin-footer">
        <p><i class="fas fa-lock"></i> Acceso Administrativo</p>
        <p class="footer-sub">
          Sistema de Control de Asistencia Docente ¬© 2026
        </p>
      </footer>
    </div>

    <!-- MODAL: CREAR/EDITAR DOCENTE -->
    <div id="modalDocente" class="modal">
      <div class="modal-content">
        <span class="close-modal" onclick="cerrarModalDocente()">&times;</span>
        <div class="modal-header" id="modalDocenteTitle">Agregar Docente</div>
        <form id="formDocente" onsubmit="guardarDocente(event)">
          <input type="hidden" id="docenteId">
          <div class="form-group">
            <label for="docenteDNI">DNI</label>
            <input type="text" id="docenteDNI" required>
          </div>
          <div class="form-group">
            <label for="docenteNombre">Nombre</label>
            <input type="text" id="docenteNombre" required>
          </div>
          <div class="form-group">
            <label for="docenteCursosIds">Cursos (Puedes seleccionar varios)</label>
            <select id="docenteCursosIds" multiple size="5">
              <!-- Se llena din√°micamente -->
            </select>
            <small style="color: #64748b; margin-top: 5px; display: block;">
              üí° Mant√©n presionado Ctrl (Cmd en Mac) para seleccionar m√∫ltiples cursos
            </small>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Guardar</button>
            <button type="button" class="btn-secondary" onclick="cerrarModalDocente()">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: CREAR/EDITAR CURSO -->
    <div id="modalCurso" class="modal">
      <div class="modal-content">
        <span class="close-modal" onclick="cerrarModalCurso()">&times;</span>
        <div class="modal-header" id="modalCursoTitle">Agregar Curso</div>
        <form id="formCurso" onsubmit="guardarCurso(event)">
          <input type="hidden" id="cursoId">
          <div class="form-group">
            <label for="cursoNombre">Nombre del Curso</label>
            <input type="text" id="cursoNombre" required>
          </div>
          <div class="form-group">
            <label for="cursoDia">D√≠a de la Semana</label>
            <select id="cursoDia" required>
              <option value="">-- Seleccionar D√≠a --</option>
              <option value="Lunes">Lunes</option>
              <option value="Martes">Martes</option>
              <option value="Mi√©rcoles">Mi√©rcoles</option>
              <option value="Jueves">Jueves</option>
              <option value="Viernes">Viernes</option>
              <option value="S√°bado">S√°bado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cursoHoraInicio">Hora Inicio (HH:MM)</label>
            <input type="time" id="cursoHoraInicio" required>
          </div>
          <div class="form-group">
            <label for="cursoHoraFin">Hora Fin (HH:MM)</label>
            <input type="time" id="cursoHoraFin" required>
          </div>
          <div class="form-group">
            <label for="cursoDescripcion">Descripci√≥n</label>
            <textarea id="cursoDescripcion"></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Guardar</button>
            <button type="button" class="btn-secondary" onclick="cerrarModalCurso()">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <script src="../scripts/data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="../scripts/admin.js"></script>

    <script>
      function confirmarBorrarHistorial() {
        Swal.fire({
          title: "¬øEliminar todo el historial?",
          text: "Esta acci√≥n no se puede deshacer. Se eliminar√°n todos los registros de asistencia.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#dc2626",
          cancelButtonColor: "#64748b",
          confirmButtonText: '<i class="fas fa-trash"></i> S√≠, eliminar todo',
          cancelButtonText: '<i class="fas fa-times"></i> Cancelar',
        }).then((result) => {
          if (result.isConfirmed) {
            borrarHistorial();
          }
        });
      }
    </script>
  </body>
</html>
